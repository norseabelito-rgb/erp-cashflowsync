---
phase: 07-task-management-core
plan: 05
type: execute
wave: 1
depends_on: []
files_modified:
  - src/app/(dashboard)/tasks/page.tsx
autonomous: true
gap_closure: true

must_haves:
  truths:
    - "Delete button in task dropdown triggers confirmation dialog"
    - "Confirming deletion calls DELETE /api/tasks/[id] API"
    - "Successful deletion removes task from list immediately"
    - "Cancelled deletion closes dialog without action"
  artifacts:
    - path: "src/app/(dashboard)/tasks/page.tsx"
      provides: "Delete mutation and confirmation dialog"
      contains: "deleteMutation"
  key_links:
    - from: "src/app/(dashboard)/tasks/page.tsx"
      to: "DELETE /api/tasks/[id]"
      via: "useMutation in deleteMutation"
      pattern: "fetch.*api/tasks.*DELETE"
---

<objective>
Wire the delete button to the existing DELETE /api/tasks/[id] API endpoint with confirmation dialog.

Purpose: Close the final gap in Phase 7 - the delete button exists in UI but has no onClick handler
Output: Fully functional task deletion with confirmation dialog and API integration
</objective>

<execution_context>
@/Users/stefanpanaite/.claude/get-shit-done/workflows/execute-plan.md
@/Users/stefanpanaite/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/phases/07-task-management-core/07-VERIFICATION.md

# Existing code patterns
@src/app/(dashboard)/tasks/page.tsx (line 185-210: toggleCompleteMutation pattern)
@src/components/orders/transfer-warning-modal.tsx (AlertDialog usage pattern)
@src/app/api/tasks/[id]/route.ts (line 286-339: DELETE endpoint already implemented)
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add delete mutation and confirmation dialog to tasks page</name>
  <files>src/app/(dashboard)/tasks/page.tsx</files>
  <action>
Wire the delete button to the DELETE API endpoint:

1. Add AlertDialog imports at top of file:
   ```typescript
   import {
     AlertDialog,
     AlertDialogAction,
     AlertDialogCancel,
     AlertDialogContent,
     AlertDialogDescription,
     AlertDialogFooter,
     AlertDialogHeader,
     AlertDialogTitle,
   } from "@/components/ui/alert-dialog";
   ```

2. Add state for delete confirmation dialog (after line 124, with editingTask state):
   ```typescript
   const [taskToDelete, setTaskToDelete] = useState<Task | null>(null);
   ```

3. Add delete mutation (after toggleCompleteMutation, around line 210):
   ```typescript
   // Delete task mutation
   const deleteMutation = useMutation({
     mutationFn: async (taskId: string) => {
       const res = await fetch(`/api/tasks/${taskId}`, {
         method: "DELETE",
       });
       if (!res.ok) {
         const error = await res.json();
         throw new Error(error.error || "Failed to delete task");
       }
       return res.json();
     },
     onSuccess: () => {
       toast({
         title: "Task sters",
         description: "Task-ul a fost sters cu succes.",
       });
       queryClient.invalidateQueries({ queryKey: ["tasks"] });
       setTaskToDelete(null);
     },
     onError: (error: Error) => {
       showError(error);
       setTaskToDelete(null);
     },
   });
   ```

4. Add handler functions (after openEditDialog, around line 233):
   ```typescript
   const openDeleteDialog = (task: Task) => setTaskToDelete(task);
   const handleConfirmDelete = () => {
     if (taskToDelete) {
       deleteMutation.mutate(taskToDelete.id);
     }
   };
   ```

5. Wire onClick to delete DropdownMenuItem (line 371):
   Change from:
   ```typescript
   <DropdownMenuItem className="text-status-error focus:text-status-error">
   ```
   To:
   ```typescript
   <DropdownMenuItem
     onClick={() => openDeleteDialog(task)}
     className="text-status-error focus:text-status-error"
   >
   ```

6. Add AlertDialog component before closing fragment (before line 541, after TaskFormDialog components):
   ```typescript
   {/* Delete Confirmation Dialog */}
   <AlertDialog open={!!taskToDelete} onOpenChange={(open) => !open && setTaskToDelete(null)}>
     <AlertDialogContent>
       <AlertDialogHeader>
         <AlertDialogTitle>Sterge task-ul?</AlertDialogTitle>
         <AlertDialogDescription>
           Aceasta actiune nu poate fi anulata. Task-ul "{taskToDelete?.title}" va fi sters definitiv.
         </AlertDialogDescription>
       </AlertDialogHeader>
       <AlertDialogFooter>
         <AlertDialogCancel disabled={deleteMutation.isPending}>Anuleaza</AlertDialogCancel>
         <AlertDialogAction
           onClick={handleConfirmDelete}
           disabled={deleteMutation.isPending}
           className="bg-destructive text-destructive-foreground hover:bg-destructive/90"
         >
           {deleteMutation.isPending ? "Se sterge..." : "Sterge"}
         </AlertDialogAction>
       </AlertDialogFooter>
     </AlertDialogContent>
   </AlertDialog>
   ```
  </action>
  <verify>
1. TypeScript compiles: `npx tsc --noEmit src/app/\(dashboard\)/tasks/page.tsx`
2. Grep confirms delete mutation exists: `grep -n "deleteMutation" src/app/\(dashboard\)/tasks/page.tsx`
3. Grep confirms AlertDialog imported: `grep -n "AlertDialog" src/app/\(dashboard\)/tasks/page.tsx`
4. Grep confirms onClick on delete button: `grep -n "openDeleteDialog" src/app/\(dashboard\)/tasks/page.tsx`
  </verify>
  <done>
- Delete DropdownMenuItem has onClick handler
- deleteMutation calls DELETE /api/tasks/[id]
- AlertDialog shows confirmation before deletion
- Task is removed from list after successful deletion
- Error handling shows error modal on failure
  </done>
</task>

</tasks>

<verification>
1. Run TypeScript check: `npx tsc --noEmit`
2. Search for delete wiring: `grep -n "deleteMutation\|taskToDelete\|openDeleteDialog" src/app/\(dashboard\)/tasks/page.tsx`
3. Verify AlertDialog imports: `grep -n "AlertDialog" src/app/\(dashboard\)/tasks/page.tsx | head -10`
4. Manual testing (human verification):
   - Navigate to /tasks
   - Click actions menu on any task
   - Click "Sterge"
   - Verify confirmation dialog appears with task title
   - Click "Anuleaza" - dialog closes, task remains
   - Click "Sterge" again, confirm - task is removed from list
</verification>

<success_criteria>
1. Delete button click opens confirmation dialog
2. Confirmation dialog shows task title for clarity
3. Cancel closes dialog without API call
4. Confirm calls DELETE API and removes task from list
5. Loading state shown during deletion
6. Error handling works (shows error modal on API failure)
7. No TypeScript errors
</success_criteria>

<output>
After completion, create `.planning/phases/07-task-management-core/07-05-SUMMARY.md`
</output>
