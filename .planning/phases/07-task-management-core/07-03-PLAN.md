---
phase: 07-task-management-core
plan: 03
type: execute
wave: 3
depends_on: ["07-02"]
files_modified:
  - src/app/(dashboard)/tasks/page.tsx
  - src/components/tasks/task-filters.tsx
  - src/lib/empty-states.ts
autonomous: true

must_haves:
  truths:
    - "Tasks page displays task list in table format"
    - "Filter presets (Today, Overdue, This week, My tasks) work"
    - "Tasks are grouped by date sections (Intarziate, Astazi, Maine, etc.)"
    - "Empty state shows when no tasks exist"
    - "Completed tasks appear at bottom in 'Finalizate' section"
  artifacts:
    - path: "src/app/(dashboard)/tasks/page.tsx"
      provides: "Task list page with table view"
      min_lines: 150
    - path: "src/components/tasks/task-filters.tsx"
      provides: "Filter presets component"
      exports: ["TaskFilters"]
    - path: "src/lib/empty-states.ts"
      provides: "Tasks module empty state config"
      contains: "tasks:"
  key_links:
    - from: "src/app/(dashboard)/tasks/page.tsx"
      to: "/api/tasks"
      via: "fetch in useQuery"
      pattern: "useQuery.*tasks|fetch.*api/tasks"
    - from: "src/app/(dashboard)/tasks/page.tsx"
      to: "src/lib/task-utils.ts"
      via: "import for date grouping"
      pattern: "import.*groupTasksByDate"
    - from: "src/app/(dashboard)/tasks/page.tsx"
      to: "src/lib/empty-states.ts"
      via: "import for empty state"
      pattern: "getEmptyState.*tasks"
---

<objective>
Create the Tasks page with table view, filtering, and date-based grouping.

Purpose: Provide the main UI for viewing and managing tasks, consistent with Orders/Invoices pages.
Output: Tasks page component, filter presets component, and empty states configuration.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/07-task-management-core/07-CONTEXT.md
@.planning/phases/07-task-management-core/07-RESEARCH.md
@.planning/phases/07-task-management-core/07-02-SUMMARY.md
@src/app/(dashboard)/invoices/page.tsx
@src/app/(dashboard)/orders/page.tsx
@src/lib/empty-states.ts
@src/lib/task-utils.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add tasks module to empty states config</name>
  <files>src/lib/empty-states.ts</files>
  <action>
Update `src/lib/empty-states.ts` to add the tasks module configuration:

1. Import ClipboardList icon from lucide-react (for first_time state)
2. Add tasks config to EMPTY_STATES object:

```typescript
tasks: {
  first_time: {
    icon: ClipboardList,
    title: "Niciun task inca",
    description: "Creeaza primul task pentru a incepe gestionarea activitatilor.",
    action: {
      label: "Creeaza task",
      onClick: "createTask"
    }
  },
  filtered: {
    icon: Search,
    title: "Niciun rezultat gasit",
    description: "Nu am gasit task-uri care sa corespunda criteriilor de cautare.",
    action: {
      label: "Reseteaza filtrele",
      onClick: "clearFilters"
    }
  },
  success: {
    icon: CheckCircle,
    title: "Toate task-urile finalizate",
    description: "Nu ai task-uri active. Buna treaba!"
  },
  error: {
    icon: AlertTriangle,
    title: "Eroare la incarcarea task-urilor",
    description: "Nu am putut incarca lista de task-uri. Incearca din nou.",
    action: {
      label: "Reincarca",
      onClick: "refresh"
    }
  }
}
```

Follow the existing pattern and Romanian text without diacritics (matching 06-06 decision).
  </action>
  <verify>Run `npx tsc --noEmit` - should compile without errors</verify>
  <done>EMPTY_STATES contains tasks module with all four state types</done>
</task>

<task type="auto">
  <name>Task 2: Create task filters component</name>
  <files>src/components/tasks/task-filters.tsx</files>
  <action>
Create `src/components/tasks/task-filters.tsx` with TaskFilters component:

1. Define filter presets as constant:
   - all: "Toate task-urile"
   - today: "Astazi"
   - overdue: "Intarziate"
   - this_week: "Saptamana aceasta"
   - my_tasks: "Task-urile mele"

2. Props interface:
   - activePreset: string (current selected preset)
   - onPresetChange: (preset: string) => void
   - typeFilter?: TaskType | "all"
   - onTypeChange?: (type: TaskType | "all") => void
   - statusFilter?: TaskStatus | "all"
   - onStatusChange?: (status: TaskStatus | "all") => void
   - assigneeFilter?: string | "all"
   - onAssigneeChange?: (assigneeId: string | "all") => void
   - users?: Array<{ id: string; name: string }>

3. Component structure:
   - Row of preset buttons (using Button with variant="ghost" or "default" for active)
   - Additional dropdowns for type, status, assignee filters
   - Use Select component from shadcn/ui for dropdowns

4. Task type options with Romanian labels:
   - PICKING: "Picking"
   - VERIFICARE: "Verificare"
   - EXPEDIERE: "Expediere"
   - MEETING: "Intalnire"
   - DEADLINE: "Deadline"
   - FOLLOW_UP: "Urmarire"
   - BUSINESS: "Business"
   - OTHER: "Altele"

5. Status options:
   - PENDING: "Active"
   - COMPLETED: "Finalizate"

Export TaskFilters as named export.
  </action>
  <verify>Run `npx tsc --noEmit` - should compile without errors</verify>
  <done>TaskFilters component exports with preset buttons and filter dropdowns</done>
</task>

<task type="auto">
  <name>Task 3: Create tasks page with table view and grouping</name>
  <files>src/app/(dashboard)/tasks/page.tsx</files>
  <action>
Create `src/app/(dashboard)/tasks/page.tsx` following the Invoices page pattern:

1. Mark as "use client"

2. Imports:
   - useQuery, useMutation, useQueryClient from @tanstack/react-query
   - Table, TableHeader, TableRow, TableHead, TableBody, TableCell from @/components/ui/table
   - Badge, Button, Checkbox, DropdownMenu components
   - ActionTooltip from @/components/ui/action-tooltip
   - EmptyState from @/components/ui/empty-state
   - SkeletonTableRow from @/components/ui/skeleton-table-row
   - useErrorModal from @/hooks/use-error-modal
   - getEmptyState, determineEmptyStateType from @/lib/empty-states
   - groupTasksByDate, DATE_GROUP_LABELS, sortTasksByPriority, isOverdue from @/lib/task-utils
   - TaskFilters from @/components/tasks/task-filters
   - Lucide icons: MoreHorizontal, Pencil, CheckCircle2, RotateCcw, Plus, etc.
   - date-fns for formatting

3. State:
   - activePreset: string (default "all")
   - typeFilter: TaskType | "all"
   - statusFilter: TaskStatus | "all"
   - assigneeFilter: string | "all"

4. Data fetching:
   - useQuery for tasks with query params based on filters
   - useQuery for users (for assignee dropdown)
   - Invalidate "tasks" on mutations

5. Mutations:
   - toggleComplete: POST /api/tasks/[id]/complete
   - On success: invalidate queries, show toast

6. Page layout:
   - Header with title "Task-uri" and "Creeaza task" button
   - TaskFilters component
   - Table with columns:
     - Checkbox (for completion toggle)
     - Titlu (title, with line-through if completed)
     - Tip (type badge)
     - Prioritate (priority badge with colors: destructive for URGENT, warning for HIGH, info for MEDIUM, neutral for LOW)
     - Responsabil (assignee name or "Neasignat")
     - Deadline (formatted date, red if overdue)
     - Actiuni (dropdown menu)

7. Grouping:
   - Group tasks using groupTasksByDate
   - Render sections for each non-empty group
   - Section header with DATE_GROUP_LABELS
   - Completed tasks at bottom in "Finalizate" section

8. Empty state:
   - Use determineEmptyStateType to pick correct state
   - Pass callbacks for clearFilters and refresh actions

9. Loading state:
   - Show SkeletonTableRow (10 rows) while loading

10. Error handling:
    - Use useErrorModal for API errors

Add ActionTooltip to all buttons following Phase 6 patterns (Romanian text, no diacritics).
  </action>
  <verify>Run `npm run build` - page should compile. Check `http://localhost:3000/tasks` in browser.</verify>
  <done>Tasks page displays grouped task list with filters, completion toggle, and empty states</done>
</task>

</tasks>

<verification>
1. `npx tsc --noEmit` passes
2. `npm run build` succeeds
3. /tasks page loads with no JavaScript errors
4. Empty state shows when no tasks
5. Filter presets change the task query
6. Tasks grouped by date sections
7. Completion toggle works (checkbox click)
</verification>

<success_criteria>
- /tasks page renders table with task data
- Filter preset buttons (Today, Overdue, etc.) filter the list
- Date sections render: Intarziate, Astazi, Maine, Saptamana aceasta, Mai tarziu, Fara deadline, Finalizate
- Clicking checkbox toggles task completion
- Overdue tasks show deadline in red
- Empty state shows appropriate message based on context
- Loading state shows skeleton rows
</success_criteria>

<output>
After completion, create `.planning/phases/07-task-management-core/07-03-SUMMARY.md`
</output>
