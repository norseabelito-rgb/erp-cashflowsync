---
phase: 07.9-reception-workflow
plan: 06
type: execute
wave: 3
depends_on: ["07.9-02"]
files_modified:
  - src/app/(dashboard)/inventory/purchase-orders/page.tsx
  - src/app/(dashboard)/inventory/purchase-orders/new/page.tsx
  - src/app/(dashboard)/inventory/purchase-orders/[id]/page.tsx
  - src/app/(dashboard)/inventory/purchase-orders/[id]/labels/page.tsx
  - src/components/inventory/PurchaseOrderForm.tsx
  - src/components/inventory/PurchaseOrderItemsTable.tsx
autonomous: true

must_haves:
  truths:
    - "Purchase orders can be viewed in a list with filtering"
    - "New purchase orders can be created with product selection"
    - "Purchase orders can be approved from the detail page"
    - "Labels can be generated and printed"
  artifacts:
    - path: "src/app/(dashboard)/inventory/purchase-orders/page.tsx"
      provides: "Purchase orders list page"
      min_lines: 80
    - path: "src/app/(dashboard)/inventory/purchase-orders/new/page.tsx"
      provides: "Create purchase order page"
      min_lines: 50
    - path: "src/components/inventory/PurchaseOrderForm.tsx"
      provides: "Reusable form component"
      min_lines: 150
  key_links:
    - from: "purchase-orders/page.tsx"
      to: "/api/purchase-orders"
      via: "fetch"
      pattern: "fetch.*api/purchase-orders"
    - from: "PurchaseOrderForm.tsx"
      to: "purchase-orders API"
      via: "form submission"
      pattern: "fetch.*api/purchase-orders"
---

<objective>
Create Purchase Orders UI pages: list view, create/edit form, detail page, and labels page.

Purpose: Enable Office staff to create and manage purchase orders through a user-friendly interface
Output: Complete UI for purchase order management including label generation
</objective>

<execution_context>
@/Users/stefanpanaite/.claude/get-shit-done/workflows/execute-plan.md
@/Users/stefanpanaite/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/07.9-reception-workflow/07.9-RESEARCH.md
@.planning/phases/07.9-reception-workflow/07.9-02-SUMMARY.md
@src/app/(dashboard)/inventory/page.tsx
@src/components/ui/data-table.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create Purchase Orders list page</name>
  <files>src/app/(dashboard)/inventory/purchase-orders/page.tsx</files>
  <action>
Create the purchase orders list page with:

**Header:**
- Title: "Precomezi" with icon (ShoppingCart from lucide-react)
- "Precomanda noua" button linking to /inventory/purchase-orders/new

**Filters:**
- Search input (searches documentNumber, supplier name)
- Status dropdown: All, DRAFT, APROBATA, IN_RECEPTIE, RECEPTIONATA, ANULATA
- Supplier dropdown (fetch from /api/suppliers)
- Date range for expectedDate

**Table columns:**
- Nr. Document (documentNumber) - link to detail page
- Furnizor (supplier.name)
- Data estimata (expectedDate formatted)
- Produse (totalItems count)
- Valoare (totalValue formatted as currency)
- Status (badge with color per status)
- Actiuni (view, edit if DRAFT, approve if DRAFT)

**Status badge colors:**
- DRAFT: gray
- APROBATA: blue
- IN_RECEPTIE: yellow
- RECEPTIONATA: green
- ANULATA: red

**Pagination:**
- Use existing pagination pattern
- 20 items per page default

Use useQuery from @tanstack/react-query for data fetching.
Follow the pattern from existing inventory pages.

Romanian labels without diacritics:
- "Precomezi" not "Precomenzi"
- "Precomanda noua" not "Precomanda nouÄƒ"
  </action>
  <verify>Page loads, shows list, filters work, links navigate correctly</verify>
  <done>Purchase orders list page with filtering, pagination, and status badges</done>
</task>

<task type="auto">
  <name>Task 2: Create Purchase Order form and new/edit pages</name>
  <files>
    src/components/inventory/PurchaseOrderForm.tsx
    src/app/(dashboard)/inventory/purchase-orders/new/page.tsx
    src/app/(dashboard)/inventory/purchase-orders/[id]/page.tsx
  </files>
  <action>
**PurchaseOrderForm.tsx:**
Reusable form component for create/edit:

Props:
- initialData?: PurchaseOrder (for edit mode)
- onSuccess: (order: PurchaseOrder) => void

Form fields:
1. Supplier selection (required)
   - Combobox searching /api/suppliers
   - Show supplier name and code

2. Expected date (optional)
   - Native date input
   - Label: "Data estimata livrare"

3. Notes (optional)
   - Textarea
   - Label: "Observatii"

4. Items section:
   - "Adauga produs" button
   - For each item row:
     - Product search (Combobox searching /api/inventory-items)
     - Quantity input (number, min 1)
     - Unit price input (number, optional)
     - Remove button
   - Show line total: qty * price
   - Show grand total

5. Action buttons:
   - "Salveaza" - saves as DRAFT
   - "Anuleaza" - returns to list

Validation:
- Supplier required
- At least one item required
- Quantities must be positive

**new/page.tsx:**
- Title: "Precomanda noua"
- Render PurchaseOrderForm
- On success: redirect to detail page

**[id]/page.tsx (detail page):**
- Fetch order by ID
- Show all order details in read-only cards
- If DRAFT: show Edit button, Approve button
- If APROBATA: show "Genereaza etichete" button
- If IN_RECEPTIE or later: show link to reception report
- Show status timeline/history

Actions on detail page:
- Edit (only DRAFT) -> opens edit mode
- Approve (only DRAFT) -> POST /api/purchase-orders/[id]/approve
- Generate labels (APROBATA) -> navigates to labels page
- Delete (only DRAFT) -> with confirmation
  </action>
  <verify>
    - Form validates required fields
    - Create saves and redirects
    - Detail shows all data
    - Approve changes status
  </verify>
  <done>
    - PurchaseOrderForm component handles create/edit
    - New page creates orders
    - Detail page shows order with actions
  </done>
</task>

<task type="auto">
  <name>Task 3: Create Labels page</name>
  <files>src/app/(dashboard)/inventory/purchase-orders/[id]/labels/page.tsx</files>
  <action>
Create labels page for printing:

**Page structure:**
- Title: "Etichete Precomanda {documentNumber}"
- Back link to order detail

**If no labels exist:**
- "Genereaza etichete" button
- POST /api/purchase-orders/[id]/labels
- Refresh page after generation

**If labels exist:**
- List of labels grouped by product
- For each label:
  - Label code (large, scannable text)
  - Product SKU and name
  - Purchase order number
  - Expected quantity
  - Print checkbox

**Print actions:**
- "Printeaza selectate" button
- "Printeaza toate" button
- Both open print dialog with formatted labels

**Print format (CSS print styles):**
- Each label on separate page (page-break-after)
- Label includes:
  - QR code or barcode (can use text representation initially)
  - Product SKU in large font
  - Product name
  - PO document number
  - Quantity

**Mark as printed:**
- After print dialog closes, prompt to mark as printed
- PUT /api/purchase-orders/[id]/labels with labelIds

Use @media print CSS for print styling.
  </action>
  <verify>
    - Labels generated for approved PO
    - Print dialog opens with formatted labels
    - Labels marked as printed after printing
  </verify>
  <done>
    - Labels can be generated for approved orders
    - Labels display in print-friendly format
    - Print tracking maintained
  </done>
</task>

</tasks>

<verification>
1. List page shows orders with all filters working
2. Create form validates and saves orders
3. Detail page shows order with appropriate actions
4. Approve button transitions order to APROBATA
5. Labels page generates and displays printable labels
</verification>

<success_criteria>
- Complete CRUD UI for purchase orders
- Workflow actions (approve, labels) work from UI
- Consistent with existing inventory UI patterns
- Print labels are scannable at warehouse
- All text in Romanian without diacritics
</success_criteria>

<output>
After completion, create `.planning/phases/07.9-reception-workflow/07.9-06-SUMMARY.md`
</output>
