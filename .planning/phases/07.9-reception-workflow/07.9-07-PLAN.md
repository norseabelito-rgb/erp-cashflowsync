---
phase: 07.9-reception-workflow
plan: 07
type: execute
wave: 3
depends_on: ["07.9-03"]
files_modified:
  - src/app/(dashboard)/inventory/reception/page.tsx
  - src/app/(dashboard)/inventory/reception/[id]/page.tsx
  - src/components/inventory/ReceptionItemsTable.tsx
  - src/components/inventory/ReceptionPhotoUpload.tsx
autonomous: true

must_haves:
  truths:
    - "Warehouse dashboard shows pending receptions"
    - "Reception report allows entering received quantities"
    - "Photos can be uploaded by category"
    - "Finalization validates all requirements"
  artifacts:
    - path: "src/app/(dashboard)/inventory/reception/page.tsx"
      provides: "Warehouse reception dashboard"
      min_lines: 100
    - path: "src/app/(dashboard)/inventory/reception/[id]/page.tsx"
      provides: "Reception report completion page"
      min_lines: 150
    - path: "src/components/inventory/ReceptionPhotoUpload.tsx"
      provides: "Photo upload component by category"
      min_lines: 80
  key_links:
    - from: "reception/page.tsx"
      to: "/api/reception-reports"
      via: "fetch"
      pattern: "fetch.*api/reception-reports"
    - from: "reception/[id]/page.tsx"
      to: "ReceptionPhotoUpload"
      via: "import"
      pattern: "ReceptionPhotoUpload"
---

<objective>
Create Reception UI for warehouse staff: dashboard showing pending receptions and detailed report completion with photo uploads.

Purpose: Enable warehouse staff (Gestionar) to document goods received with quantities and photos
Output: Complete reception workflow UI from dashboard to finalization
</objective>

<execution_context>
@/Users/stefanpanaite/.claude/get-shit-done/workflows/execute-plan.md
@/Users/stefanpanaite/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/07.9-reception-workflow/07.9-RESEARCH.md
@.planning/phases/07.9-reception-workflow/07.9-03-SUMMARY.md
@src/app/(dashboard)/inventory/page.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create Warehouse Reception Dashboard</name>
  <files>src/app/(dashboard)/inventory/reception/page.tsx</files>
  <action>
Create the warehouse reception dashboard:

**Header:**
- Title: "Receptie Marfa" with icon (Package from lucide-react)

**Pending Purchase Orders Section:**
- Title: "Precomezi in asteptare"
- Cards for each PO with status APROBATA:
  - Document number
  - Supplier name
  - Expected date (with urgency indicator if past due)
  - Total items count
  - "Incepe receptia" button

**Active Receptions Section:**
- Title: "Receptii in curs"
- Cards for each ReceptionReport with status DESCHIS or IN_COMPLETARE:
  - Report number (PV-...)
  - Purchase order reference
  - Supplier name
  - Progress: X/Y items verified
  - "Continua" button to detail page

**Completed Today Section:**
- Title: "Finalizate azi"
- List of ReceptionReports with status FINALIZAT from today
  - Report number
  - NIR number generated
  - Time completed

**Action flow:**
1. Click "Incepe receptia" on PO
2. POST /api/reception-reports with { purchaseOrderId }
3. Redirect to /inventory/reception/[newReportId]

Fetch data:
- GET /api/purchase-orders?status=APROBATA
- GET /api/reception-reports?status=DESCHIS,IN_COMPLETARE
- GET /api/reception-reports?status=FINALIZAT&dateFrom=today

Use cards layout with responsive grid.
  </action>
  <verify>
    - Dashboard shows pending POs
    - Active receptions display with progress
    - "Incepe receptia" creates report and redirects
  </verify>
  <done>
    - Warehouse staff can see all pending work
    - New receptions can be started from dashboard
    - Progress visible for active receptions
  </done>
</task>

<task type="auto">
  <name>Task 2: Create Reception Report Completion Page</name>
  <files>
    src/app/(dashboard)/inventory/reception/[id]/page.tsx
    src/components/inventory/ReceptionItemsTable.tsx
  </files>
  <action>
**ReceptionItemsTable.tsx:**
Editable table for reception line items:

Props:
- items: ReceptionReportItem[]
- onItemUpdate: (itemId, updates) => void
- disabled: boolean (true when finalized)

Columns:
- SKU (from inventoryItem)
- Denumire (product name)
- Cant. Asteptata (quantityExpected, read-only)
- Cant. Primita (quantityReceived, editable number input)
- Diferenta (calculated: received - expected, colored red if negative)
- Verificat (checkbox)
- Observatii (text input, required if difference exists)

Row styling:
- Yellow background if hasDifference and not verified
- Green background if verified
- Red text for negative difference

**[id]/page.tsx:**
Reception report completion page:

**Header:**
- Back button to dashboard
- Report number and status badge
- Purchase order reference link
- Supplier name

**Info Cards Row:**
- Furnizor card with supplier details
- Factura furnizor card:
  - If linked: show invoice number, date
  - If not linked: "Ataseaza factura" button
    - Opens modal to select from /api/supplier-invoices or create new
    - PUT /api/reception-reports/[id] with supplierInvoiceId

**Items Section:**
- ReceptionItemsTable component
- "Salveaza progres" button
  - PUT /api/reception-reports/[id]/items with all items
  - Show success toast

**Photos Section:**
- ReceptionPhotoUpload component (Task 3)
- 4 categories displayed:
  - OVERVIEW (Obligatoriu)
  - ETICHETE (Obligatoriu)
  - FACTURA (Obligatoriu)
  - DETERIORARI (Optional, obligatoriu daca deteriorari notate)

**Finalization Section:**
- Checkbox: "Confirm semnatura gestionar"
- "Finalizeaza receptia" button (disabled until all ready)

**Validation checklist displayed:**
- All items have quantityReceived: check/x
- All items verified: check/x
- Items with differences have observations: check/x
- Required photos uploaded: check/x
- Invoice attached: check/x
- Signature confirmed: check/x

On finalize:
- POST /api/reception-reports/[id]/finalize
- On success: show NIR number, redirect to dashboard
- On error: show validation errors
  </action>
  <verify>
    - Items can be edited and saved
    - Differences auto-detected
    - Validation checklist updates live
    - Finalize creates NIR on success
  </verify>
  <done>
    - Complete reception report interface
    - Line items editable with validation
    - Progress auto-saved
    - Finalization enforces all requirements
  </done>
</task>

<task type="auto">
  <name>Task 3: Create Photo Upload Component</name>
  <files>src/components/inventory/ReceptionPhotoUpload.tsx</files>
  <action>
Create photo upload component for reception:

Props:
- receptionReportId: string
- photos: ReceptionPhoto[]
- onPhotosChange: () => void (refetch callback)
- disabled: boolean

Layout:
- Grid of 4 category sections (2x2 on desktop, 1 column on mobile)

Each category section:
- Category name and required/optional badge
- If photo exists:
  - Thumbnail image
  - Filename
  - Delete button (X icon)
- If no photo:
  - Upload dropzone
  - "Click sau trage fisier"
  - Accepts: jpg, jpeg, png, webp, heic

Upload handling:
- On file drop/select:
  - Show upload progress
  - POST /api/reception-reports/[id]/photos with FormData
  - On success: call onPhotosChange()
  - On error: show error toast

Delete handling:
- DELETE /api/reception-reports/[id]/photos?photoId=xxx
- Confirmation before delete
- On success: call onPhotosChange()

Visual indicators:
- Green border if category has photo
- Red border if required and missing
- Gray border for optional

Use existing upload patterns from the codebase.
Drag and drop using native HTML5 drag events (no external library needed).
  </action>
  <verify>
    - Photos upload to correct category
    - Thumbnails display after upload
    - Delete removes photo
    - Required indicators work
  </verify>
  <done>
    - Photo upload component handles all 4 categories
    - Visual feedback for required/uploaded status
    - Drag and drop and click to upload supported
  </done>
</task>

</tasks>

<verification>
1. Dashboard shows pending receptions correctly
2. New reception creates report from PO
3. Items table allows quantity entry and verification
4. Photos upload to correct categories
5. Finalize validates all requirements
6. NIR generated on successful finalization
</verification>

<success_criteria>
- Warehouse staff can complete full reception workflow
- Progress visible and can be resumed
- Photo requirements enforced
- Differences highlighted and require explanation
- Finalization creates NIR automatically
</success_criteria>

<output>
After completion, create `.planning/phases/07.9-reception-workflow/07.9-07-SUMMARY.md`
</output>
