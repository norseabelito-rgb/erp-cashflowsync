---
phase: 07.9-reception-workflow
plan: 09
type: execute
wave: 3
depends_on: ["07.9-04"]
files_modified:
  - src/app/(dashboard)/inventory/supplier-invoices/page.tsx
  - src/app/(dashboard)/inventory/supplier-invoices/[id]/page.tsx
  - src/components/inventory/SupplierInvoiceForm.tsx
autonomous: true

must_haves:
  truths:
    - "Supplier invoices can be viewed in a list with filtering"
    - "New invoices can be created with document upload"
    - "Payment status can be updated"
    - "Invoice documents can be viewed/downloaded"
  artifacts:
    - path: "src/app/(dashboard)/inventory/supplier-invoices/page.tsx"
      provides: "Supplier invoices list page"
      min_lines: 100
    - path: "src/app/(dashboard)/inventory/supplier-invoices/[id]/page.tsx"
      provides: "Supplier invoice detail page"
      min_lines: 80
    - path: "src/components/inventory/SupplierInvoiceForm.tsx"
      provides: "Invoice form component"
      min_lines: 100
  key_links:
    - from: "supplier-invoices/page.tsx"
      to: "/api/supplier-invoices"
      via: "fetch"
      pattern: "fetch.*api/supplier-invoices"
---

<objective>
Create Supplier Invoices UI pages: list view with filtering, detail page, and create/edit form with document upload.

Purpose: Enable tracking of supplier invoices received during goods reception
Output: Complete UI for supplier invoice management
</objective>

<execution_context>
@/Users/stefanpanaite/.claude/get-shit-done/workflows/execute-plan.md
@/Users/stefanpanaite/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/07.9-reception-workflow/07.9-RESEARCH.md
@.planning/phases/07.9-reception-workflow/07.9-04-SUMMARY.md
@src/app/(dashboard)/inventory/page.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create Supplier Invoices List Page</name>
  <files>src/app/(dashboard)/inventory/supplier-invoices/page.tsx</files>
  <action>
Create the supplier invoices list page:

**Header:**
- Title: "Facturi Furnizori" with icon (Receipt from lucide-react)
- "Factura noua" button opens create form modal

**Stats Cards Row:**
- Neplatite (count and sum of NEPLATITA)
- Partial platite (count and sum of PARTIAL_PLATITA)
- Platite luna aceasta (count of PLATITA this month)
- Total neplatit (sum of totalWithVat where not PLATITA)

**Filters:**
- Search (invoiceNumber, supplier.name)
- Supplier dropdown
- Payment status dropdown
- Date range (invoiceDate)
- Purchase order (if linked)

**Table columns:**
- Serie/Nr Factura (invoiceSeries + invoiceNumber)
- Furnizor (supplier.name) - link to supplier
- Data factura (invoiceDate)
- Valoare (totalWithVat formatted)
- Scadenta (paymentDueDate, colored red if overdue)
- Status plata (badge)
- Document (icon if documentPath exists, click to view)
- Actiuni (view, edit)

**Payment status badges:**
- NEPLATITA: red
- PARTIAL_PLATITA: yellow
- PLATITA: green

**Overdue indicator:**
- If paymentDueDate < today and status != PLATITA
- Red text or warning icon

Pagination: 20 per page default
Sorting: by invoiceDate DESC default
  </action>
  <verify>
    - List shows invoices with all columns
    - Filters work correctly
    - Stats calculate accurately
    - Overdue invoices highlighted
  </verify>
  <done>
    - Supplier invoices list with filtering and stats
    - Payment status visible with color coding
    - Overdue invoices clearly indicated
  </done>
</task>

<task type="auto">
  <name>Task 2: Create Invoice Form and Detail Page</name>
  <files>
    src/components/inventory/SupplierInvoiceForm.tsx
    src/app/(dashboard)/inventory/supplier-invoices/[id]/page.tsx
  </files>
  <action>
**SupplierInvoiceForm.tsx:**
Form component for create/edit:

Props:
- initialData?: SupplierInvoice
- onSuccess: (invoice) => void
- onCancel: () => void

Form fields:
1. Supplier selection (required)
   - Combobox searching /api/suppliers

2. Invoice details:
   - invoiceSeries (optional text)
   - invoiceNumber (required)
   - invoiceDate (required, date input)

3. Values:
   - totalValue (required, number)
   - vatValue (optional, number)
   - totalWithVat (auto-calc if vatValue provided, or manual)

4. Payment:
   - paymentDueDate (optional, date)
   - paymentStatus (dropdown)
   - paidAt (shown if PLATITA, auto-set or manual)

5. Notes (optional textarea)

6. Document upload:
   - If no document: upload dropzone
   - If document exists: show filename with view/replace options
   - Upload calls /api/supplier-invoices/upload

7. Purchase Order link (optional):
   - Combobox to select from POs of same supplier

Validation:
- Supplier required
- Invoice number required
- Invoice date required
- Total value required
- Duplicate check (same supplier + series + number)

**[id]/page.tsx:**
Invoice detail page:

**Header:**
- Back to list
- Invoice identification (series/number)
- Status badge

**Info Cards:**
- Supplier details card
- Invoice details card (dates, values)
- Payment details card (status, due date, paid date)

**Document Section:**
- If documentPath exists:
  - Preview (if image) or download link (if PDF)
  - "Inlocuieste document" button
- If no document:
  - "Incarca document" upload area

**Linked Documents:**
- Purchase Order (if linked) - link
- Reception Reports using this invoice - links
- NIRs using this invoice - links

**Actions:**
- Edit button -> opens form modal
- Update payment status quick action
- Delete (if no linked documents)

Payment status quick update:
- Dropdown to change status directly
- Auto-sets paidAt when changing to PLATITA
  </action>
  <verify>
    - Form validates all required fields
    - Document upload works
    - Detail page shows all information
    - Payment status can be updated
  </verify>
  <done>
    - Invoice form handles create and edit
    - Document upload and viewing works
    - Detail page shows linked documents
    - Payment tracking functional
  </done>
</task>

</tasks>

<verification>
1. List page shows invoices with filtering
2. Stats show accurate payment summaries
3. Create form validates and saves
4. Document upload stores and displays
5. Payment status updates correctly
6. Linked documents shown on detail page
</verification>

<success_criteria>
- Complete CRUD for supplier invoices
- Document upload and viewing works
- Payment tracking with overdue indicators
- Integration with purchase orders visible
- All text in Romanian without diacritics
</success_criteria>

<output>
After completion, create `.planning/phases/07.9-reception-workflow/07.9-09-SUMMARY.md`
</output>
