---
phase: 07.5-awb-tracking-fix
plan: 03
type: execute
wave: 2
depends_on: ["07.5-01", "07.5-02"]
files_modified:
  - src/app/(dashboard)/tracking/status-modal.tsx
  - src/app/(dashboard)/tracking/page.tsx
autonomous: true

must_haves:
  truths:
    - "Clicking a status card opens a modal with status explanation in Romanian"
    - "Modal shows status code, name, description, and action recommendation"
    - "Modal includes semantic color matching the status category"
    - "User can close modal and filter is still applied"
  artifacts:
    - path: "src/app/(dashboard)/tracking/status-modal.tsx"
      provides: "StatusExplanationModal component with Romanian content"
      exports: ["StatusExplanationModal"]
    - path: "src/app/(dashboard)/tracking/page.tsx"
      provides: "Tracking page with modal integration"
      min_lines: 450
  key_links:
    - from: "src/app/(dashboard)/tracking/page.tsx"
      to: "src/app/(dashboard)/tracking/status-modal.tsx"
      via: "import and render StatusExplanationModal"
      pattern: "import.*StatusExplanationModal"
---

<objective>
Add status explanation modal that shows detailed Romanian explanation and action recommendation when user clicks on a status card or status badge.

Purpose: Users need to understand what each FanCourier status means and what action (if any) they should take. Modal provides this context without cluttering the main UI.

Output: Reusable StatusExplanationModal component integrated into tracking page.
</objective>

<execution_context>
@/Users/stefanpanaite/.claude/get-shit-done/workflows/execute-plan.md
@/Users/stefanpanaite/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/07.5-awb-tracking-fix/07.5-CONTEXT.md
@.planning/phases/07.5-awb-tracking-fix/07.5-RESEARCH.md
@.planning/phases/07.5-awb-tracking-fix/07.5-01-SUMMARY.md
@.planning/phases/07.5-awb-tracking-fix/07.5-02-SUMMARY.md
@src/app/(dashboard)/tracking/page.tsx
@src/lib/fancourier-statuses.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create StatusExplanationModal component</name>
  <files>src/app/(dashboard)/tracking/status-modal.tsx</files>
  <action>
Create src/app/(dashboard)/tracking/status-modal.tsx:

```typescript
"use client";

import {
  Dialog,
  DialogContent,
  DialogHeader,
  DialogTitle,
  DialogDescription,
} from "@/components/ui/dialog";
import { Badge } from "@/components/ui/badge";
import { cn } from "@/lib/utils";
import {
  CheckCircle2,
  Truck,
  Clock,
  AlertCircle,
  RotateCcw,
  Ban,
  Package,
  Info,
} from "lucide-react";

interface StatusExplanationModalProps {
  isOpen: boolean;
  onClose: () => void;
  status: {
    code: string;
    name: string;
    description: string;
    action?: string;
    color: string;
    isFinal: boolean;
    category?: string;
  } | null;
}

// Map status categories to icons
const categoryIcons: Record<string, React.ElementType> = {
  pickup: Truck,
  transit: Truck,
  delivery: Truck,
  notice: Clock,
  problem: AlertCircle,
  return: RotateCcw,
  cancel: Ban,
  other: Package,
};

export function StatusExplanationModal({
  isOpen,
  onClose,
  status,
}: StatusExplanationModalProps) {
  if (!status) return null;

  const Icon = categoryIcons[status.category || "other"] || Package;

  // Determine badge variant based on category
  const getBadgeVariant = () => {
    if (status.code === "S2") return "success"; // Delivered
    if (status.category === "return" || status.category === "cancel") return "destructive";
    if (status.category === "problem") return "warning";
    return "default";
  };

  return (
    <Dialog open={isOpen} onOpenChange={onClose}>
      <DialogContent className="sm:max-w-md">
        <DialogHeader>
          <DialogTitle className="flex items-center gap-3">
            <div
              className="p-2 rounded-lg"
              style={{ backgroundColor: `${status.color}20` }}
            >
              <Icon className="h-5 w-5" style={{ color: status.color }} />
            </div>
            <div className="flex flex-col gap-1">
              <div className="flex items-center gap-2">
                <Badge variant={getBadgeVariant()}>{status.code}</Badge>
                <span className="font-semibold">{status.name}</span>
              </div>
              {status.isFinal && (
                <span className="text-xs text-muted-foreground">
                  Status final
                </span>
              )}
            </div>
          </DialogTitle>
        </DialogHeader>

        <div className="space-y-4 pt-2">
          {/* Description section */}
          <div>
            <h4 className="text-sm font-medium text-foreground mb-1 flex items-center gap-1">
              <Info className="h-3.5 w-3.5" />
              Ce inseamna?
            </h4>
            <p className="text-sm text-muted-foreground leading-relaxed">
              {status.description}
            </p>
          </div>

          {/* Action section - only show if action is defined */}
          {status.action && (
            <div
              className="p-3 rounded-lg"
              style={{ backgroundColor: `${status.color}10` }}
            >
              <h4 className="text-sm font-medium text-foreground mb-1">
                Ce trebuie sa faci?
              </h4>
              <p className="text-sm text-muted-foreground leading-relaxed">
                {status.action}
              </p>
            </div>
          )}

          {/* No action needed indicator for final statuses */}
          {status.isFinal && !status.action && (
            <div className="p-3 rounded-lg bg-muted/50">
              <p className="text-sm text-muted-foreground flex items-center gap-2">
                <CheckCircle2 className="h-4 w-4 text-status-success" />
                Nu este necesara nicio actiune.
              </p>
            </div>
          )}
        </div>
      </DialogContent>
    </Dialog>
  );
}
```

The modal:
- Shows status code in a badge with category-appropriate color
- Displays status name and description
- Shows action recommendation if available
- Indicates if status is final
- Uses semantic colors matching status category
  </action>
  <verify>Check that the file exists and has no TypeScript errors with `npx tsc --noEmit`.</verify>
  <done>StatusExplanationModal component created with Romanian content and semantic styling.</done>
</task>

<task type="auto">
  <name>Task 2: Integrate modal into tracking page</name>
  <files>src/app/(dashboard)/tracking/page.tsx</files>
  <action>
Update src/app/(dashboard)/tracking/page.tsx to integrate the StatusExplanationModal:

1. Import the modal component:
```typescript
import { StatusExplanationModal } from "./status-modal";
import { FANCOURIER_STATUSES } from "@/lib/fancourier-statuses";
```

2. Add state for modal:
```typescript
const [selectedStatus, setSelectedStatus] = useState<{
  code: string;
  name: string;
  description: string;
  action?: string;
  color: string;
  isFinal: boolean;
  category?: string;
} | null>(null);
```

3. Add function to open modal with status info - **CRITICAL WIRING for action field**:
```typescript
const openStatusModal = (code: string) => {
  // Get status info from FANCOURIER_STATUSES
  const statusInfo = FANCOURIER_STATUSES[code];
  if (statusInfo) {
    const display = formatStatusForDisplay(code);
    setSelectedStatus({
      code,
      name: statusInfo.name,
      description: statusInfo.description,
      // KEY WIRING: action comes directly from FANCOURIER_STATUSES[code].action
      // This field was added in 07.5-01 Task 3 to fancourier-statuses.ts
      // Examples: S4 -> "Verificati adresa si contactati clientul"
      //           S6 -> "Contactati clientul pentru clarificari"
      action: statusInfo.action,  // <-- THIS IS THE CRITICAL LINK
      color: display.color,
      isFinal: statusInfo.isFinal,
      category: statusInfo.category,
    });
  } else {
    // Unknown status - no action available
    setSelectedStatus({
      code,
      name: "Status necunoscut",
      description: `Codul "${code}" nu este recunoscut in sistemul nostru. Aceasta poate fi un status nou de la FanCourier.`,
      action: undefined,  // No action for unknown statuses
      color: "#9ca3af",
      isFinal: false,
    });
  }
};
```

4. Add info icon button to each status card that opens the modal:
```tsx
<Card onClick={() => setStatusFilter(status.code)}>
  <CardContent className="p-4 text-center relative">
    <Button
      size="icon"
      variant="ghost"
      className="absolute top-1 right-1 h-6 w-6"
      onClick={(e) => {
        e.stopPropagation();
        openStatusModal(status.code);
      }}
    >
      <Info className="h-3.5 w-3.5" />
    </Button>
    <p className="text-2xl font-bold">{status.count}</p>
    <p className="text-xs">{status.name}</p>
  </CardContent>
</Card>
```

5. Also add ability to click on status badge in AWB card to open modal:
   - In the AWB list, the badge showing current status should be clickable
   - Clicking opens modal for that status

6. Render the modal at the end of the component:
```tsx
<StatusExplanationModal
  isOpen={selectedStatus !== null}
  onClose={() => setSelectedStatus(null)}
  status={selectedStatus}
/>
```
  </action>
  <verify>
1. Click the info icon on a status card - modal should open with explanation
2. Close modal - filter state should be unchanged
3. Click on status badge in AWB card - modal should open
4. Modal content should be in Romanian
  </verify>
  <done>StatusExplanationModal integrated into tracking page with info buttons and badge clicks.</done>
</task>

</tasks>

<verification>
After completing all tasks:

1. Navigate to /tracking page
2. Click info icon on a status card - verify modal opens with:
   - Status code in badge
   - Romanian status name
   - Romanian description
   - Action recommendation (if applicable)
   - "Status final" indicator for final statuses
3. Close modal - verify filter is not affected
4. Click on a status badge within an AWB card - verify modal opens
5. Check modal styling matches status color
6. Test with "Necunoscut" status if available - verify fallback content
</verification>

<success_criteria>
- StatusExplanationModal component exists in tracking folder
- Info icon button on each status card
- Clicking info icon opens modal without changing filter
- Status badges in AWB list are clickable and open modal
- Modal displays Romanian content (Ce inseamna? / Ce trebuie sa faci?)
- Modal uses semantic colors matching status category
- Modal shows "Status final" indicator for final statuses
- Unknown statuses show appropriate fallback content
</success_criteria>

<output>
After completion, create `.planning/phases/07.5-awb-tracking-fix/07.5-03-SUMMARY.md`
</output>
