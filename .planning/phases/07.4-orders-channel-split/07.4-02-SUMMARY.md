---
phase: 07.4-orders-channel-split
plan: 02
subsystem: orders
tags: [error-handling, ui-components, collapsible-panel, channel-badges]
dependency-graph:
  requires: []
  provides: [processing-errors-panel, inline-error-badges, error-counts-by-source]
  affects: [07.4-03, 07.4-04, 07.4-05]
tech-stack:
  added: []
  patterns: [collapsible-ui, channel-badge-styling]
key-files:
  created:
    - src/components/orders/processing-errors-panel.tsx
  modified:
    - src/app/(dashboard)/orders/page.tsx
decisions:
  - id: "07.4-02-01"
    context: "Error panel should show errors from all channels regardless of active tab"
    choice: "ProcessingErrorsPanel receives full error data, panel filters don't apply"
    rationale: "Users need to see all errors to address them, not just current channel"
  - id: "07.4-02-02"
    context: "How to show channel breakdown in error panel"
    choice: "errorsBySource object calculated from session + db errors, passed as prop"
    rationale: "Decoupled calculation allows panel to display without knowing order context"
  - id: "07.4-02-03"
    context: "Inline error indicator on order rows"
    choice: "Red dot badge on Status column using hasOrderError helper"
    rationale: "Status column already shows order state, error dot complements it"
metrics:
  duration: ~18min
  completed: 2026-02-03
---

# Phase 07.4 Plan 02: Processing Errors Panel Summary

Collapsible error panel with channel badges showing all processing errors, plus inline error indicators on order rows.

## Commits

| Hash | Type | Description |
|------|------|-------------|
| 5acc6d2 | feat | Create ProcessingErrorsPanel component |
| 8bc7d5b | feat | Integrate ProcessingErrorsPanel and add inline error badges |

## Changes

### Task 1: ProcessingErrorsPanel Component

Created `/src/components/orders/processing-errors-panel.tsx`:

- **Exports**: `ProcessingErrorsPanel`, `ProcessError`, `DBProcessingError` types
- **Props interface**: errors, dbErrors, isLoading, errorsBySource, callbacks
- **State**: isCollapsed (auto-expands when errors appear, collapses when resolved)
- **UI sections**:
  - Header bar: Alert icon, error count, channel breakdown (Shopify: X | Trendyol: Y)
  - Collapse/expand toggle button
  - "Reincearca toate" and clear session errors buttons
  - Collapsible content with "Erori in sesiune" and "Erori persistente" sections
- **Error cards**: Order number, channel badge, error type badge (INVOICE/AWB), truncated error message with tooltip, retry/skip buttons
- **Styling**: bg-status-error/5, border-status-error/20, channel badges match order table

### Task 2: Integration and Inline Badges

Modified `/src/app/(dashboard)/orders/page.tsx`:

1. **Import ProcessingErrorsPanel** with types
2. **Removed duplicate interfaces** - using types from component
3. **Processing-errors query always enabled** - not just errors tab
4. **Added errorsBySource calculation**:
   - Counts session + db errors by order source
   - Handles both ProcessError (orderId) and DBProcessingError (order.source)
5. **Added hasOrderError helper** - checks if order has active error
6. **Replaced inline error display** with ProcessingErrorsPanel
7. **Added inline error badges** - red dot on Status column for orders with errors

### Deviation: Fix sourceFilter Compatibility

**[Rule 3 - Blocking]** Plan 07.4-01 modified orders page to use channelTab from URL but left references to sourceFilter without declaration. Fixed by deriving sourceFilter from channelTab for backward compatibility.

## Verification

- [x] TypeScript compilation passes (no errors in modified files)
- [x] ProcessingErrorsPanel exports and isCollapsed state present
- [x] Channel badge rendering implemented
- [x] Collapse/expand functionality via button
- [x] ProcessingErrorsPanel integrated in orders page
- [x] errorsBySource passed to panel
- [x] Inline error badges on Status column

## Decisions Made

1. **Error panel independence**: Panel shows ALL errors regardless of active channel tab - users need full visibility
2. **Channel breakdown via prop**: errorsBySource calculated in parent, passed to panel for decoupling
3. **Status column for badges**: Red dot indicator on Status column complements existing state display
4. **Auto-collapse behavior**: Panel auto-hides when no errors, auto-shows when errors appear

## Files

- **Created**: `src/components/orders/processing-errors-panel.tsx` (374 lines)
- **Modified**: `src/app/(dashboard)/orders/page.tsx` (+38/-41 lines)

## Next Phase Readiness

Ready for:
- 07.4-03: Order table column additions
- 07.4-04: Manual order creation
- 07.4-05: Store filters per channel

No blockers identified.
