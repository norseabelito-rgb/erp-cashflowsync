---
phase: 06-ux-foundation
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - src/components/ui/error-modal.tsx
  - src/lib/error-messages.ts
autonomous: true

must_haves:
  truths:
    - "ErrorModal displays error icon, title, description, and optional technical details"
    - "Technical details are copyable with copy button feedback"
    - "Error messages are user-friendly Romanian text, not technical jargon"
    - "ErrorModal has configurable action buttons"
  artifacts:
    - path: "src/components/ui/error-modal.tsx"
      provides: "Centralized error modal component"
      exports: ["ErrorModal", "ErrorModalProps"]
    - path: "src/lib/error-messages.ts"
      provides: "Error message mapping from technical to user-friendly"
      exports: ["getErrorMessage", "ERROR_MESSAGES"]
  key_links:
    - from: "src/components/ui/error-modal.tsx"
      to: "@/components/ui/dialog"
      via: "Dialog component import"
      pattern: "import.*Dialog"
---

<objective>
Create the ErrorModal component and error message mapping system for consistent, user-friendly error handling across the application.

Purpose: Replace ad-hoc error handling with a standardized modal that displays clear, actionable messages in Romanian. Technical details are available but secondary to the user-friendly explanation.

Output: ErrorModal component ready for use in all API error handlers, plus a centralized error message mapping utility.
</objective>

<execution_context>
@/Users/stefanpanaite/.claude/get-shit-done/workflows/execute-plan.md
@/Users/stefanpanaite/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/06-ux-foundation/06-CONTEXT.md
@.planning/phases/06-ux-foundation/06-RESEARCH.md

# Existing components to reference:
@src/components/ui/dialog.tsx
@src/components/ui/button.tsx
@src/lib/design-system.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create error message mapping utility</name>
  <files>src/lib/error-messages.ts</files>
  <action>
Create a utility for mapping technical errors to user-friendly Romanian messages.

Define ERROR_MESSAGES constant with common error patterns:
```typescript
export const ERROR_MESSAGES: Record<string, { title: string; description: string }> = {
  // Network errors
  "NETWORK_ERROR": {
    title: "Eroare de conexiune",
    description: "Nu s-a putut conecta la server. Verifica conexiunea la internet si incearca din nou."
  },
  "TIMEOUT": {
    title: "Cererea a expirat",
    description: "Serverul nu a raspuns la timp. Incearca din nou mai tarziu."
  },

  // Auth errors
  "UNAUTHORIZED": {
    title: "Neautorizat",
    description: "Sesiunea ta a expirat. Te rugam sa te autentifici din nou."
  },
  "FORBIDDEN": {
    title: "Acces interzis",
    description: "Nu ai permisiunea necesara pentru aceasta actiune."
  },

  // Invoice errors
  "INVOICE_GENERATION_FAILED": {
    title: "Eroare la generarea facturii",
    description: "Factura nu a putut fi generata. Verifica datele comenzii si incearca din nou."
  },
  "SERIES_NOT_CONFIGURED": {
    title: "Serie facturare neconfigrata",
    description: "Nu exista o serie de facturare configurata pentru acest magazin. Configureaza seria in Setari."
  },
  "OBLIO_CONNECTION_ERROR": {
    title: "Eroare conexiune Oblio",
    description: "Nu s-a putut conecta la serviciul Oblio. Verifica credentialele si incearca din nou."
  },

  // AWB errors
  "AWB_GENERATION_FAILED": {
    title: "Eroare la generarea AWB",
    description: "AWB-ul nu a putut fi generat. Verifica datele de livrare si incearca din nou."
  },
  "COURIER_CONNECTION_ERROR": {
    title: "Eroare conexiune curier",
    description: "Nu s-a putut conecta la serviciul curierului. Incearca din nou mai tarziu."
  },

  // Stock errors
  "INSUFFICIENT_STOCK": {
    title: "Stoc insuficient",
    description: "Nu exista suficient stoc pentru a finaliza aceasta operatie."
  },

  // Generic
  "UNKNOWN_ERROR": {
    title: "Eroare necunoscuta",
    description: "A aparut o eroare neasteptata. Daca problema persista, contacteaza suportul."
  }
};
```

Create getErrorMessage function:
```typescript
export function getErrorMessage(error: unknown): { title: string; description: string; details?: string } {
  // Handle different error types:
  // 1. If error has .code property, look up in ERROR_MESSAGES
  // 2. If error has .message that matches known pattern, use that
  // 3. If error is HTTP response, map status codes (401, 403, 404, 500)
  // 4. Fall back to UNKNOWN_ERROR
  // Always include original error as details for debugging
}
```

Also export a helper to detect error codes from common patterns (ECONNREFUSED, timeout, etc.).
  </action>
  <verify>
- File exists: src/lib/error-messages.ts
- Exports ERROR_MESSAGES and getErrorMessage
- Contains at least 10 error mappings
  </verify>
  <done>Error message mapping utility created with Romanian translations</done>
</task>

<task type="auto">
  <name>Task 2: Create ErrorModal component</name>
  <files>src/components/ui/error-modal.tsx</files>
  <action>
Create a modal component for displaying errors with consistent styling.

Interface:
```typescript
export interface ErrorModalProps {
  /** Whether the modal is open */
  open: boolean;
  /** Called when modal should close */
  onClose: () => void;
  /** Error title (required) */
  title: string;
  /** User-friendly error description (required) */
  description: string;
  /** Technical details (optional, shown in collapsible/code block) */
  details?: string;
  /** Action buttons (optional, defaults to "Am inteles" dismiss button) */
  actions?: Array<{
    label: string;
    onClick?: () => void;
    href?: string;
    variant?: "default" | "outline" | "secondary" | "destructive";
  }>;
}
```

Component structure:
1. DialogContent with sm:max-w-md
2. DialogHeader with:
   - Error icon (AlertTriangle from lucide) in rounded bg-status-error/10 container
   - DialogTitle with title
   - DialogDescription with description
3. Technical details section (if provided):
   - Muted background (bg-muted/50 rounded-lg p-3)
   - Code block with text-xs text-muted-foreground
   - Copy button with Check/Copy icon toggle
   - Max-h-32 with overflow-y-auto for long details
4. DialogFooter with:
   - Custom actions if provided
   - Default "Am inteles" button if no actions

Copy functionality:
- Use navigator.clipboard.writeText
- Show Check icon for 2 seconds after copying
- Button variant ghost, size icon

Import from:
- @/components/ui/dialog (Dialog, DialogContent, DialogHeader, etc.)
- @/components/ui/button
- lucide-react (AlertTriangle, Copy, Check)
  </action>
  <verify>
- File exists: src/components/ui/error-modal.tsx
- Exports ErrorModal and ErrorModalProps
- Imports Dialog components
- Has copy functionality with useState
  </verify>
  <done>ErrorModal component created with copy details functionality and Romanian default text</done>
</task>

</tasks>

<verification>
After all tasks complete:

1. Error messages check:
```bash
grep -c "title:" src/lib/error-messages.ts  # Should be >= 10
grep -n "export function getErrorMessage" src/lib/error-messages.ts
```

2. ErrorModal check:
```bash
grep -n "export function ErrorModal" src/components/ui/error-modal.tsx
grep -n "navigator.clipboard" src/components/ui/error-modal.tsx
```

3. Build check:
```bash
npm run build 2>&1 | head -30
```
</verification>

<success_criteria>
- ERROR_MESSAGES contains 10+ Romanian error mappings
- getErrorMessage function handles various error types
- ErrorModal component displays title, description, optional details
- Copy button works with visual feedback
- Default "Am inteles" button when no actions provided
- Build passes without errors
</success_criteria>

<output>
After completion, create `.planning/phases/06-ux-foundation/06-02-SUMMARY.md`
</output>
