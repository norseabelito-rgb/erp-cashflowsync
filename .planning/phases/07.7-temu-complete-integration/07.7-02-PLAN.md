---
phase: 07.7-temu-complete-integration
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - src/app/api/temu/stores/route.ts
  - src/app/api/temu/stores/[id]/route.ts
  - src/components/settings/TemuStoresTab.tsx
autonomous: true

must_haves:
  truths:
    - "Admin can create a TemuStore with company association"
    - "Admin can edit TemuStore credentials and invoice series"
    - "Admin can delete a TemuStore"
    - "TemuStoresTab appears in Settings page"
  artifacts:
    - path: "src/app/api/temu/stores/route.ts"
      provides: "GET and POST endpoints for TemuStore CRUD"
      exports: ["GET", "POST"]
      min_lines: 80
    - path: "src/app/api/temu/stores/[id]/route.ts"
      provides: "GET, PATCH, DELETE endpoints for individual TemuStore"
      exports: ["GET", "PATCH", "DELETE"]
      min_lines: 60
    - path: "src/components/settings/TemuStoresTab.tsx"
      provides: "Settings tab for managing Temu stores"
      min_lines: 200
  key_links:
    - from: "src/components/settings/TemuStoresTab.tsx"
      to: "/api/temu/stores"
      via: "fetch/useSWR"
      pattern: "/api/temu/stores"
---

<objective>
Create TemuStore CRUD API endpoints and Settings UI component for managing Temu seller accounts, following the established TrendyolStoresTab pattern exactly.

Purpose: Enable admin users to configure Temu seller accounts with company associations and invoice series, just like TrendyolStore configuration.

Output: Working TemuStoresTab component in Settings page with full CRUD functionality.
</objective>

<execution_context>
@/Users/stefanpanaite/.claude/get-shit-done/workflows/execute-plan.md
@/Users/stefanpanaite/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/07.7-temu-complete-integration/07.7-RESEARCH.md

# Pattern reference
@src/app/api/trendyol/stores/route.ts
@src/app/api/trendyol/stores/[id]/route.ts
@src/components/settings/TrendyolStoresTab.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create TemuStore API Routes</name>
  <files>src/app/api/temu/stores/route.ts, src/app/api/temu/stores/[id]/route.ts</files>
  <action>
Create CRUD API endpoints for TemuStore following TrendyolStore pattern.

1. Create src/app/api/temu/stores/route.ts:

   GET handler:
   - Permission check: settings.view
   - Fetch all TemuStore records with company and order counts
   - Include: company { id, name }, _count: { orders: true }
   - Return JSON array

   POST handler:
   - Permission check: settings.edit
   - Validate required fields: name, appKey, appSecret, accessToken, companyId
   - Optional fields: webhookSecret, region (default "EU"), currencyRate, invoiceSeriesName
   - Set accessTokenExpiry to 3 months from now
   - Create TemuStore record
   - Return created store with 201 status

2. Create src/app/api/temu/stores/[id]/route.ts:

   GET handler:
   - Permission check: settings.view
   - Fetch single TemuStore by id with relations
   - Return 404 if not found

   PATCH handler:
   - Permission check: settings.edit
   - Validate store exists
   - Update allowed fields: name, appKey, appSecret, accessToken, accessTokenExpiry, webhookSecret, region, currencyRate, invoiceSeriesName, companyId, isActive
   - Return updated store

   DELETE handler:
   - Permission check: settings.edit
   - Check no orders linked to store (optional: allow force delete)
   - Delete store
   - Return 204 No Content

Use error handling pattern from existing API routes.
Include Romanian error messages for validation failures.
  </action>
  <verify>
Run: `npx tsc --noEmit src/app/api/temu/stores/route.ts src/app/api/temu/stores/[id]/route.ts`
Verify no TypeScript errors.
  </verify>
  <done>
GET /api/temu/stores returns list of stores with company info.
POST /api/temu/stores creates new store.
GET /api/temu/stores/[id] returns single store.
PATCH /api/temu/stores/[id] updates store.
DELETE /api/temu/stores/[id] removes store.
  </done>
</task>

<task type="auto">
  <name>Task 2: Create TemuStoresTab Component</name>
  <files>src/components/settings/TemuStoresTab.tsx</files>
  <action>
Create TemuStoresTab component following TrendyolStoresTab pattern exactly.

1. Component structure:
   - Use useSWR to fetch /api/temu/stores
   - State for selectedStore (for edit/create dialog)
   - State for deleteConfirm (store id being deleted)

2. Store list display:
   - Table with columns: Name, Company, Region, Invoice Series, Status, Orders, Actions
   - Show store.company.name for company
   - Show badge for region (EU, US, GLOBAL)
   - Show invoiceSeriesName or "Neconfigurata"
   - Show isActive as badge (Activ/Inactiv)
   - Show order count
   - Actions: Edit, Delete buttons with tooltips

3. Create/Edit dialog:
   - Form fields:
     - name: text input (required)
     - companyId: select from companies list (required)
     - appKey: text input (required)
     - appSecret: password input (required)
     - accessToken: textarea (required)
     - accessTokenExpiry: date picker (show current expiry)
     - region: select (EU, US, GLOBAL, default EU)
     - invoiceSeriesName: text input (Oblio series name)
     - currencyRate: number input (optional)
     - webhookSecret: password input (optional)
     - isActive: switch
   - Show warning about token expiry (3 months)
   - Submit calls POST or PATCH based on mode

4. Delete confirmation dialog:
   - Show store name
   - Warn if store has orders
   - Confirm button calls DELETE

5. Fetch companies list on mount for dropdown

Use Romanian labels without diacritics (same as TrendyolStoresTab).
Follow UI patterns from existing settings components.
  </action>
  <verify>
Run: `npx tsc --noEmit src/components/settings/TemuStoresTab.tsx`
Verify no TypeScript errors.
  </verify>
  <done>
TemuStoresTab component renders store list.
Create/Edit dialog works for adding/updating stores.
Delete confirmation dialog prevents accidental deletion.
All fields map to TemuStore model correctly.
  </done>
</task>

<task type="auto">
  <name>Task 3: Integrate TemuStoresTab into Settings Page</name>
  <files>src/app/(dashboard)/settings/page.tsx</files>
  <action>
Add TemuStoresTab to the Settings page following existing pattern for TrendyolStoresTab.

1. Import TemuStoresTab component

2. Add "Temu" tab to settings tabs (after Trendyol tab):
   - Tab trigger: "Temu" with Temu icon (or Store icon)
   - Tab content: TemuStoresTab component

3. Ensure tab only shows for users with settings.view permission

Follow existing tab structure in settings page.
Place Temu tab after Trendyol tab for consistent channel ordering.
  </action>
  <verify>
Run dev server and navigate to /settings
Verify Temu tab appears and TemuStoresTab renders.
  </verify>
  <done>
Temu tab visible in Settings page.
TemuStoresTab component loads when tab is selected.
Tab requires settings.view permission.
  </done>
</task>

</tasks>

<verification>
1. TypeScript compiles: `npx tsc --noEmit`
2. API routes respond:
   - `curl http://localhost:3000/api/temu/stores` (returns [] or 401)
3. Component renders: Navigate to /settings and click Temu tab
4. CRUD works: Create, edit, delete a test store
</verification>

<success_criteria>
- TemuStore API routes support full CRUD
- TemuStoresTab component matches TrendyolStoresTab pattern
- Settings page has Temu tab with working component
- Romanian labels used throughout
- Permission checks on all endpoints
</success_criteria>

<output>
After completion, create `.planning/phases/07.7-temu-complete-integration/07.7-02-SUMMARY.md`
</output>
