---
phase: 07.3-dashboard-rework
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/app/(dashboard)/dashboard/dashboard-filters.tsx
  - src/app/(dashboard)/dashboard/page.tsx
autonomous: true

must_haves:
  truths:
    - "Date range and store filters are visible at top of dashboard"
    - "Changing date filter updates URL with startDate and endDate params"
    - "Changing store filter updates URL with store param"
    - "Page refresh preserves filter state from URL"
    - "Default date filter shows today's data"
  artifacts:
    - path: "src/app/(dashboard)/dashboard/dashboard-filters.tsx"
      provides: "DashboardFilters component with date range and store selector"
      min_lines: 80
  key_links:
    - from: "src/app/(dashboard)/dashboard/dashboard-filters.tsx"
      to: "useSearchParams/useRouter"
      via: "Next.js navigation hooks"
      pattern: "useSearchParams|useRouter"
    - from: "src/app/(dashboard)/dashboard/page.tsx"
      to: "DashboardFilters"
      via: "import and render"
      pattern: "import.*DashboardFilters"
---

<objective>
Create a global filter bar for the dashboard with date range picker (single day or range) and store selector, persisted to URL search params.

Purpose: Establish consistent filter state that all dashboard components will respect. Currently the chart has its own store filter but cards show global (unfiltered) metrics - this creates a unified filter that affects everything.

Output: New DashboardFilters component rendered at top of dashboard, URL-persisted filter state
</objective>

<execution_context>
@/Users/stefanpanaite/.claude/get-shit-done/workflows/execute-plan.md
@/Users/stefanpanaite/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/07.3-dashboard-rework/07.3-RESEARCH.md

# Current dashboard files
@src/app/(dashboard)/dashboard/page.tsx
@src/app/(dashboard)/dashboard/dashboard-charts.tsx

# Existing patterns to reuse
@src/components/ui/feature-tooltip.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create DashboardFilters component</name>
  <files>src/app/(dashboard)/dashboard/dashboard-filters.tsx</files>
  <action>
Create a new client component "use client" with:

1. Import useRouter, useSearchParams from "next/navigation"
2. Import existing UI components: Select, SelectContent, SelectItem, SelectTrigger, SelectValue from @/components/ui/select
3. Import icons: Calendar, Store from lucide-react

4. Props interface:
   - stores: Array<{id: string, name: string}> - list of active stores

5. Read current filter state from searchParams:
   - startDate: searchParams.get("startDate") || today's date in YYYY-MM-DD format
   - endDate: searchParams.get("endDate") || same as startDate (single day default)
   - storeId: searchParams.get("store") || "all"

6. Create handleFilterChange function that:
   - Builds new URLSearchParams from current params
   - Sets/deletes the changed parameter
   - Calls router.push with updated params
   - Uses router.push(`/dashboard?${params.toString()}`)

7. Render filter bar with:
   - Date range inputs (native HTML date inputs - existing pattern from orders page)
     - Start date label: "De la"
     - End date label: "Pana la"
   - Quick date buttons: "Azi", "Saptamana aceasta", "Luna aceasta"
   - Store dropdown (reuse pattern from dashboard-charts.tsx)
     - Label: "Magazin"
     - First option: "Toate magazinele" with value "all"

8. Style with Tailwind:
   - Flex row with gap-4
   - Items centered vertically
   - Small text (text-sm) for labels
   - Consistent with existing dashboard-charts store filter

Use Romanian labels without diacritics per decision 06-06.
  </action>
  <verify>
File exists at src/app/(dashboard)/dashboard/dashboard-filters.tsx and exports DashboardFilters component.
Run: grep -n "export function DashboardFilters" src/app/(dashboard)/dashboard/dashboard-filters.tsx
  </verify>
  <done>DashboardFilters component created with date range inputs, quick date buttons, and store selector</done>
</task>

<task type="auto">
  <name>Task 2: Integrate DashboardFilters into dashboard page</name>
  <files>src/app/(dashboard)/dashboard/page.tsx</files>
  <action>
Modify the dashboard page.tsx:

1. Import DashboardFilters from "./dashboard-filters"

2. Update searchParams type to include:
   - store?: string (existing)
   - startDate?: string (new)
   - endDate?: string (new)

3. Pass stores data to DashboardFilters:
   - Extract stores array from stats.stores (already fetched)
   - Render DashboardFilters below PageHeader, above the first stat cards grid
   - Wrap in Suspense for proper hydration

4. Remove the store filter from DashboardCharts component call (it will now use global filter):
   - Keep passing salesData
   - Keep passing stores (for chart legend if needed)
   - Remove currentStoreId prop (filter is now global)

5. Update getStats function signature:
   - Accept { storeId, startDate, endDate } object instead of just storeId
   - Parse dates from strings if provided
   - Apply date filter to all queries (next plan will implement this fully)
   - For now, just pass through the params

Layout should be:
- PageHeader
- DashboardFilters (new)
- Stat cards grid
- Charts row
- etc.
  </action>
  <verify>
Run: grep -n "DashboardFilters" src/app/(dashboard)/dashboard/page.tsx
Should show import and component usage.
  </verify>
  <done>Dashboard page imports and renders DashboardFilters, URL filter state is readable by page</done>
</task>

</tasks>

<verification>
1. Start dev server: npm run dev
2. Visit /dashboard
3. Verify filter bar appears below header
4. Change date range - URL should update with startDate and endDate params
5. Change store - URL should update with store param
6. Refresh page - filters should persist from URL
7. Clear URL params - should default to today and "all" stores
</verification>

<success_criteria>
- DashboardFilters component renders with date inputs and store selector
- URL updates when filters change (can be verified via browser address bar)
- Page refresh preserves filter state
- Default state is today's date and all stores
</success_criteria>

<output>
After completion, create `.planning/phases/07.3-dashboard-rework/07.3-01-SUMMARY.md`
</output>
