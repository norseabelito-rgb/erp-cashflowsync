---
phase: 07.3-dashboard-rework
plan: 05
type: execute
wave: 3
depends_on: ["07.3-03", "07.3-04"]
files_modified:
  - src/app/(dashboard)/dashboard/page.tsx
  - src/lib/dashboard-stats.ts
autonomous: true

must_haves:
  truths:
    - "Ads section is completely removed from dashboard"
    - "AI Insights section is completely removed from dashboard"
    - "New Retururi card shows count of returned orders/AWBs"
    - "Retururi card navigates to tracking page with returned filter"
    - "Quick Stats section no longer shows Ads-related items"
  artifacts:
    - path: "src/app/(dashboard)/dashboard/page.tsx"
      provides: "Dashboard without Ads/AI sections, with Retururi card"
  key_links:
    - from: "src/lib/dashboard-stats.ts"
      to: "getStatusCategory logic"
      via: "AWB return counting"
      pattern: "returned|retur"
---

<objective>
Remove unused Ads and AI Insights sections from dashboard, add new "Retururi" card for tracking returns.

Purpose: User confirmed Ads and AI Insights sections are not useful for daily operations. Returns tracking is a gap - no card shows return count currently. This cleanup makes dashboard focused on operational metrics.

Output: Cleaner dashboard with Ads/AI removed, new Retururi card visible
</objective>

<execution_context>
@/Users/stefanpanaite/.claude/get-shit-done/workflows/execute-plan.md
@/Users/stefanpanaite/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/07.3-dashboard-rework/07.3-RESEARCH.md

# Dashboard files
@src/app/(dashboard)/dashboard/page.tsx
@src/app/(dashboard)/dashboard/dashboard-ai-insights.tsx
@src/lib/dashboard-stats.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add returns count to dashboard stats</name>
  <files>src/lib/dashboard-stats.ts</files>
  <action>
Extend getFilteredDashboardStats to include returns count:

1. Add to the DashboardStats interface:
   ```typescript
   returns: number; // Count of returned orders/AWBs
   ```

2. In getFilteredDashboardStats, add return counting logic:

   Option A (AWB-based - preferred for consistency with tracking page):
   ```typescript
   // Count AWBs with return status
   // This matches tracking page getStatusCategory logic for 'returned'
   const returnsQuery = prisma.aWB.count({
     where: {
       ...baseWhere, // Apply date filter to AWB.createdAt
       OR: [
         { currentStatus: { contains: 'retur', mode: 'insensitive' } },
         { currentStatus: { contains: 'refuz', mode: 'insensitive' } },
         { currentStatus: { contains: 'return', mode: 'insensitive' } },
       ],
     },
   });
   ```

   Note: The baseWhere for AWBs should filter by createdAt (when AWB was created), consistent with order date filtering.

   If storeId filter is needed, AWB links to Order, so:
   ```typescript
   const awbReturnsWhere = {
     createdAt: dateWhere,
     ...(storeId && {
       order: { storeId },
     }),
     OR: [
       { currentStatus: { contains: 'retur', mode: 'insensitive' } },
       { currentStatus: { contains: 'refuz', mode: 'insensitive' } },
       { currentStatus: { contains: 'return', mode: 'insensitive' } },
     ],
   };
   ```

3. Add returnsQuery to Promise.all
4. Include returns count in returned stats object
  </action>
  <verify>
Run: grep -n "returns" src/lib/dashboard-stats.ts
Should show returns property in interface and in query.
  </verify>
  <done>dashboard-stats.ts includes returns count based on AWB status</done>
</task>

<task type="auto">
  <name>Task 2: Remove Ads and AI sections, add Retururi card</name>
  <files>src/app/(dashboard)/dashboard/page.tsx</files>
  <action>
Clean up dashboard page by removing unused sections and adding returns card:

1. REMOVE Ads-related content:
   - Remove import of Megaphone icon if only used for Ads
   - Remove "ROAS Ads" StatCard (if not already removed in Plan 02)
   - Remove Quick Stats items for "Cheltuieli Ads" and "Venituri Ads"
   - Remove any ads-related variables from stats destructuring

2. REMOVE AI Insights section:
   - Remove import of DashboardAIInsights component
   - Remove the entire <div id="ai-insights"> section with Suspense wrapper
   - Remove import of Sparkles icon if only used for AI
   - Remove pendingInsights badge from PageHeader
   - Remove stats.pendingInsights usage

3. ADD Retururi card in the first stats row (where ROAS Ads was):
   ```tsx
   <StatCard
     title="Retururi"
     value={stats.returns}
     icon={RotateCcw}
     description="Colete returnate sau in curs de returnare"
     tooltip="Comenzi returnate sau in curs de returnare"
     variant={stats.returns > 0 ? "warning" : "default"}
     href={buildFilteredHref("/tracking", { status: "returned" })}
   />
   ```

   Import RotateCcw icon from lucide-react for returns

4. Update Quick Stats section:
   - Remove Ads spend/revenue items
   - Keep: Total Produse, Stoc Scazut, Erori Validare
   - Optionally add: Retururi quick stat if not in main grid

5. Clean up unused imports:
   - DashboardAIInsights if not used
   - Any Ads-specific icons
   - Sparkles if not used elsewhere

6. Verify grid layouts still work (may need to adjust grid columns if removing cards changed count)
  </action>
  <verify>
Run: grep -n "DashboardAIInsights\|adsROAS\|adsSpend\|adsRevenue" src/app/(dashboard)/dashboard/page.tsx
Should return 0 lines (all Ads/AI references removed).

Run: grep -n "Retururi" src/app/(dashboard)/dashboard/page.tsx
Should show the new Retururi card.
  </verify>
  <done>Dashboard cleaned up - Ads/AI removed, Retururi card added</done>
</task>

</tasks>

<verification>
1. Run: npm run build - should pass with no errors
2. Start dev server: npm run dev
3. Visit /dashboard
4. Verify NO Ads section visible (no ROAS card, no Ads spend/revenue in Quick Stats)
5. Verify NO AI Insights section visible
6. Verify Retururi card appears in first row
7. Click Retururi card - should navigate to /tracking?status=returned with current filters
8. Verify page layout looks clean and balanced
</verification>

<success_criteria>
- No Ads-related content on dashboard (ROAS card gone, Quick Stats cleaned)
- No AI Insights section on dashboard
- Retururi card visible with count and working navigation
- Dashboard layout remains visually balanced
- Build passes with no errors
</success_criteria>

<output>
After completion, create `.planning/phases/07.3-dashboard-rework/07.3-05-SUMMARY.md`
</output>
