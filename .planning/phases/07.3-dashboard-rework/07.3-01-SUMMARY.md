---
phase: "07.3-dashboard-rework"
plan: "01"
subsystem: "dashboard"
tags: ["filters", "url-state", "next-navigation", "date-picker"]

depends:
  requires: []
  provides:
    - "DashboardFilters component with date range and store selector"
    - "URL-persisted filter state (startDate, endDate, store params)"
    - "Quick date buttons (Azi, Saptamana aceasta, Luna aceasta)"
  affects:
    - "07.3-02 (will use filter state to filter queries)"
    - "07.3-03 (will use filter state for card metrics)"

tech-stack:
  added: []
  patterns:
    - "useSearchParams for URL state reading"
    - "useRouter.push for URL state updates"
    - "Native HTML date inputs"

key-files:
  created:
    - "src/app/(dashboard)/dashboard/dashboard-filters.tsx"
  modified:
    - "src/app/(dashboard)/dashboard/page.tsx"
    - "src/app/(dashboard)/dashboard/dashboard-charts.tsx"

decisions:
  - id: "07.3-01-01"
    decision: "Use native HTML date inputs instead of calendar picker"
    rationale: "Follows existing pattern from orders page, simpler implementation"
  - id: "07.3-01-02"
    decision: "Remove store filter from DashboardCharts component"
    rationale: "Global DashboardFilters now handles store selection for all components"
  - id: "07.3-01-03"
    decision: "Default date filter is today (single day)"
    rationale: "Most common use case - checking today's metrics"

metrics:
  duration: "~5 minutes"
  completed: "2026-02-03"
---

# Phase 07.3 Plan 01: Dashboard Global Filters Summary

**One-liner:** Created DashboardFilters component with date range picker and store selector, URL-persisted state, rendered at top of dashboard.

## What Was Built

### DashboardFilters Component (`src/app/(dashboard)/dashboard/dashboard-filters.tsx`)

A client component that provides:
- **Date range inputs** - "De la" (start) and "Pana la" (end) using native HTML date inputs
- **Quick date buttons** - "Azi", "Saptamana aceasta", "Luna aceasta" for common selections
- **Store selector** - Dropdown with "Toate magazinele" as default option
- **URL persistence** - All filter state is synced to URL search params (startDate, endDate, store)

### Dashboard Page Integration

- DashboardFilters rendered below PageHeader, above stat cards
- Wrapped in Suspense for proper hydration
- Page reads filter params from URL (searchParams)
- DashboardCharts simplified to only receive salesData (no longer has its own store filter)

## Technical Implementation

```typescript
// Filter state from URL
const startDate = searchParams.get("startDate") || getToday();
const endDate = searchParams.get("endDate") || startDate;
const storeId = searchParams.get("store") || "all";

// URL update on filter change
router.push(`/dashboard?${params.toString()}`);
```

## Commits

| Hash | Type | Description |
|------|------|-------------|
| 23c7167 | feat | Create DashboardFilters component |
| ba3ceff | feat | Integrate DashboardFilters into dashboard page |
| a90c6e3 | fix | Restore missing imports in dashboard page |

## Verification Results

- [x] DashboardFilters component created (201 lines, exceeds 80 min)
- [x] Uses useSearchParams and useRouter from next/navigation
- [x] Dashboard page imports and renders DashboardFilters
- [x] Filter bar appears below header with date inputs and store dropdown
- [x] URL updates when filters change
- [x] Default state is today's date and "all" stores

## Deviations from Plan

### Auto-fixed Issues

**1. [Rule 1 - Bug] Restored missing imports after external refactoring**
- **Found during:** Final verification
- **Issue:** External process removed DollarSign, Megaphone, and DashboardAIInsights imports but they were still used
- **Fix:** Added missing imports back
- **Files modified:** `src/app/(dashboard)/dashboard/page.tsx`
- **Commit:** a90c6e3

## Next Phase Readiness

**Ready for Plan 07.3-02:** The filter state is now available in the URL. Plan 02 will:
- Read startDate/endDate from searchParams in getStats
- Apply date filtering to all dashboard queries
- Cards and metrics will reflect filtered date range

**Filter State Contract:**
- `startDate`: YYYY-MM-DD format, defaults to today
- `endDate`: YYYY-MM-DD format, defaults to startDate
- `store`: Store ID or "all" (omitted from URL when "all")
